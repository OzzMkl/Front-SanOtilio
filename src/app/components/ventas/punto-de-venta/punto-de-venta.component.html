<p-toast></p-toast>
<div class="container-xxl">
    <app-loading-spinner [isLoading]="isLoadingGeneral"></app-loading-spinner>
    <!-- DATOS CLIENTE -->
    <div>
        <h4 class="text-center">DATOS DEL CLIENTE</h4>
        <div class="row align-items-start" >
            <div class="col-4">
                <label class="form-label" for="">Buscar cliente</label>
                    <div class="input-group">
                        <span class="input-group-addon" id="sizing-addon2"><i class="bi-search" style="font-size: 1.5rem; color: black; left: 0;" (click)="open(content,0)"></i></span>
                        <input class="form-control" type="text" name="nomreCliente" #nombreCliente="ngModel" [(ngModel)]="ventag.nombreCliente" readonly >
                    </div>
            </div>
            <div class="col-1">
                <br>
                <button class="btn btn-success" (click)="open(content2,1)" ngbTooltip="Agregar cliente"><i class="bi bi-plus-circle-dotted" style="font-size: 1.3rem; color: rgb(255, 249, 249); left: 0;"></i></button>
            </div>
            <div class="col-2" *ngFor="let c of cliente">
                <label class="form-label">RFC</label>
                <input class="form-control" type="text" value="{{c.rfc}}"  readonly>
            </div>
            <div class="col-2" *ngFor="let c of cliente">
                <label class="form-label">Tipo cliente</label>
                <input class="form-control" type="text" value="{{c.nombreTipoC}}"  readonly>
            </div>
            <!-- <div class="col-1" *ngFor="let c of cliente">
                <p>{{c.nombreStatus}}</p>
            </div> -->
            <div *ngIf="ventag.nombreCliente.length > 0" class="col-2">
                <label class="form-label" for="flexSwitchCheckDefault">¿Se envia?</label>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" name="seEnvia" [(ngModel)]="seEnvia" (change)="modalSeEnvia(buscarDireccion)" (click)="getDireccionCliente(ventag.idCliente)" >
                  </div>
            </div>
        </div>
        <!-- //<br> -->
        <div *ngIf="seEnvia == true" class="row">
            <div class="col">
                <label class="form-label">Direccion del cliente</label>
                <!-- <input type="text" class="form-control" value="{{ventag.dirCliente}}" readonly> -->
                <textarea class="form-control" value="{{ventag.cdireccion}}" readonly></textarea>
            </div>
        </div>
    </div>
    <hr>
    <!-- PRODUCTOS -->
    <div class="row align-items-start">
        <h4 class="text-center">AGREGAR PRODUCTO</h4>
        <div class="col-2">
            <label class="form-label" for="">Buscar producto</label>
                <div class="input-group">
                    <span class="input-group-addon" id="sizing-addon2" (click)="modalBuscarProducto(mBuscarProducto)" ><i class="bi-search" style="font-size: 1.5rem; color: black; left: 0;"></i></span>
                    <input class="form-control" type="text" name="claveEx" #claveEx="ngModel" [(ngModel)]="productoVentag.claveEx" readonly>
                </div>
        </div>
        <div class="col-2">
            <label class="form-label">Medida</label>
            <select class="form-select" name="nombreMedida" id="nombreMedida" #nombreMedida="ngModel" [(ngModel)]="productoVentag.idProdMedida" ngModel (change)="muestraPrecios()" required>
                <option *ngFor="let pm of productos_medidas" value="{{pm.idProdMedida}}" >{{pm.nombreMedida}}</option>
            </select>
        </div>
        <div [ngClass]="{'col-1': PagoConTarjeta, 'col-2': !PagoConTarjeta}">
            <label class="form-label">Cantidad</label>
            <input class="form-control" type="number" min="0" name="cantidad" #cantidad="ngModel" [(ngModel)]="productoVentag.cantidad" (change)="calculaSubtotalPP()">
        </div>
        <div class="col-2">
            <label class="form-label">Precio</label>
                <input class="offset-md-1 form-check-input" type="checkbox" pTooltip="Modificar precio" tooltipPosition="top" [(ngModel)]="isModificaPrecio" (ngModelChange)="habilitaInputPrecio($event)">
            <div *ngIf="isModificaPrecio == false; else blockModificaPrecio">
                <select class="form-select" name="precio" id="precio" #precio="ngModel" [(ngModel)]="productoVentag.precio" (change)="calculaSubtotalPP()">
                    <option *ngFor="let precio of preciosArray" value="{{precio}}">{{precio}}</option>
                </select>
            </div>

            <ng-template #blockModificaPrecio>
                <input class="form-control" type="number" name="precio" id="precio" #precio="ngModel" [(ngModel)]="productoVentag.precio" (change)="calculaSubtotalPP()">
            </ng-template>

            <!-- <input class="form-control" type="number" min="{{productoVentag.precioMinimo}}" name="precio" #precio="ngModel" [(ngModel)]="productoVentag.precio" (change)="calculaSubtotalPP()" > -->
        </div>
        <div class="col-2" *ngIf="PagoConTarjeta">
            <label class="form-label" for="">Comision</label>
            <input class="form-control" type="number" name="comision" id="comision" #comision="ngModel" [(ngModel)]="productoVentag.comision" readonly>
        </div>
        <div [ngClass]="{'col-1': PagoConTarjeta, 'col-2': !PagoConTarjeta}">
            <label class="form-label">Descuento</label>
            <input class="form-control" type="number" min="0" name="descuento" #descuento="ngModel" [(ngModel)]="productoVentag.descuento" (change)="calculaSubtotalPP()">
        </div>
        <div class="col-2">
            <label class="form-label">Subtotal</label>
            <input class="form-control" type="number" value="{{productoVentag.subtotal}}" readonly >
        </div>
        <div class="col">
            <label class="" for="">Descripcion</label>
            <input type="text" class="form-control" name="descripcion" #descripcion="ngModel" [(ngModel)]="productoVentag.descripcion" readonly>
        </div>
        <div class="col-2">
            <!-- <label class="form-label">.</label> -->
            <br>
            <button class="btn btn-success form-control" type="button" [disabled]="isSearch" (click)="agregarProductoLista()">
                <i class="bi bi-check-circle-fill" > Agregar</i>
            </button>
        </div>
    </div>
    <hr>
    <!-- LISTA PRODUCTOS -->
    <div>
        <h4 class="text-center">LISTA DE PRODUCTOS</h4>
        <table class="table table-dark table-hover">
            <thead>
                <tr>
                    <th scope="col">CLAVE EXTERNA</th>
                    <th scope="col">DESCRIPCION</th>
                    <th scope="col">CANTIDAD</th>
                    <th scope="col">MEDIDA</th>
                    <th scope="col">PRECIO</th>
                    <th scope="col">DESCUENTO</th>
                    <th scope="col">SUBTOTAL</th>
                </tr>
            </thead>
            <tbody *ngFor="let producto of lista_productoVentag | paginate:{id:'tablePV', itemsPerPage: 5, currentPage:pageActual3}">
                <tr (click)="editarProductoLista(producto.idProdMedida)" >
                    <th scope="row">{{producto.claveEx}}</th>
                    <th scope="row">{{producto.descripcion}}</th>
                    <th scope="row">{{producto.cantidad}}</th>
                    <th scope="row">{{producto.nombreMedida}}</th>
                    <th scope="row">{{producto.precio | currency}}</th>
                    <th scope="row">{{producto.descuento | currency}}</th>
                    <th scope="row">{{producto.subtotal | currency}}</th>
                </tr>
            </tbody>
        </table>
        <pagination-controls id="tablePV" (pageChange)="pageActual3 = $event"></pagination-controls>
    </div>
    <hr>
    <!-- FINAL VENTA -->
    <div class="row">
        <div class="col-10">
            <label class="form-label">Observaciones</label>
            <textarea class="form-control" rows="3" maxlength="250" 
                        name="observaciones" #observaciones="ngModel"
                        placeholder="Ingrese unicamente observaciones"
                        [(ngModel)]="ventag.observaciones" 
                        (keydown)="contadorCaracteres($event)">
            </textarea>
            <span> {{contador}}/250</span>
            <br>

            <div class="row">
                <div class="col-2">
                    <label for="">Subtotal</label>
                    <input class="form-control" type="text" value="{{ventag.subtotal | currency}}" readonly>
                </div>
                <div class="col-2">
                    <label for="">Descuento</label>
                    <input class="form-control" type="text" value="{{ventag.descuento | currency}}" readonly>
                </div>
                <div class="col-2">
                    <label for="">Total</label>
                    <input class="form-control" type="text" value="{{ventag.total | currency}}" readonly>
                </div>
                <div class="col-3">
                    <label class="form-label" for="">Tipo venta</label>
                    <select class="form-select" name="tipoventa" id="tipoventa" #tipoventa="ngModel" [(ngModel)]="ventag.idTipoVenta" ngModel required>
                        <option *ngFor="let tipoV of tipo_venta" value="{{tipoV.idTipoVenta}}">{{tipoV.nombre}}</option>
                    </select>
                </div>
                <div class="col-2">
                    <label class="form-label" for="">¿Pago con tarjeta?</label>
                    <div class="col-md-5 offset-md-5">
                        <input class="form-check-input" type="checkbox" name="PagoConTarjeta" id="PagoConTarjeta" [(ngModel)]="PagoConTarjeta" (ngModelChange)="sumaPorcentajeComi($event)">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-2">
            <div class="col">
                <button class="btn btn-secondary form-control" (click)="modalAlertaExistencia(mAlertaExistencia)"><i class="bi bi-file-earmark-medical"></i> Cotizacion</button>
            </div>
            <br>
            <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000" acceptLabel="Si" rejectButtonStyleClass="p-button-text"></p-confirmDialog>
            <div class="col">
                <button class="btn btn-success form-control" (click)="confirmVenta()"><i class="bi bi-receipt-cutoff"> </i> Ticket</button>
            </div>
            <br>
            <div class="col">
                <button class="btn btn-info form-control" (click)="obtenerUltimaCotiza()"><i class="bi bi-truck"></i> Pedido</button>
            </div>
        </div>
    </div>

    
</div>



<!-- Modal buscar clientes-->
<ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Buscar cliente</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
            <div class="col">
                <input type="search" class="form-control" name="nombreCliente" placeholder="buscar por nombre" (keyup)="searchNombreClienteS($event)">
            </div>
            <div class="text-center text-primary" *ngIf="isLoadingClientes">
                <!-- <div class="spinner-border" role="status" >
                    <span class="visually-hidden">Loading...</span>
                  </div> -->
                  <br>
                  <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="4"></p-progressSpinner>
            </div>
            <br>
            <div *ngIf="!isLoadingClientes">
                <table class="table table-sm table-dark table-hover">
                    <thead>
                        <tr>
                            <th scope="col">NOMBRE</th>
                            <th scope="col">RFC</th>
                            <th scope="col">TELEFONO</th>
                            <th scope="col">TIPO CLIENTE</th>
                        </tr>
                    </thead>
                    <tbody *ngFor="let c of clientes | paginate:{id:'pagCliente',itemsPerPage: itemsPerPage, currentPage: pageActual, totalItems:totalPagesClientes}">
                        <tr (click)="seleccionarCliente(c.idCliente)" (click)="modal.dismiss('Cross click')">
                            <th scope="row">{{ c.nombreCliente.length > 40 ? (c.nombreCliente | slice:0:25) + '...' : c.nombreCliente }}</th>
                            
                            <th scope="row">{{c.rfc}}</th>
                            <th scope="row">{{c.telefono}}</th>
                            <th scope="row">{{c.nombreTipoC}}</th>
                        </tr>
                    </tbody>
                </table>
                <pagination-controls 
                        id="pagCliente" 
                        (pageChange)="getPageClientes(pageActual = $event)"
                        previousLabel="Anterior"
                        nextLabel="Siguiente" >
                </pagination-controls>
            </div>
    </div>
    <!-- <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Guardar</button>
    </div> -->
</ng-template>

<!-- Modal agregar cliente-->
<ng-template #content2 let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Agregar cliente</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col">
            <h5 class="text-center">DATOS PERSONALES</h5>
            </div>
            <div class="col">
                <div class="form-check form-switch">
                    <label class="form-check-label" for="flexSwitchCheckDefault">¿Es una empresa?</label>
                    <input class="form-check-input" type="checkbox" role="switch"  id="flexSwitchCheckDefault" name="isCompany" [(ngModel)]="isCompany">
                  </div>
            </div>
        </div>
        <form #fGuardarCliente="ngForm" >
            <div class="row align-items-start">
                <div *ngIf="isCompany == false; else elseBlock" class="row">
                    <div class="col-4">
                        <label class="form-label" for="">Nombre(s) *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text" maxlength="254"
                                name="nombre" #nombre="ngModel" [(ngModel)]="modeloCliente.nombre" ngModel required>
                        <div [hidden]="nombre.valid || nombre.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                          </div>
                    </div>
                    <div class="col-3">
                        <label class="form-label" for="">Apellido paterno</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text" maxlength="80"
                                name="aPaterno" #aPaterno="ngModel" [(ngModel)]="modeloCliente.aPaterno">
                    </div>
                    <div class="col-3">
                        <label class="form-label" for="">Apellido materno</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text" maxlength="80"
                                name="aMaterno" #aMaterno="ngModel" [(ngModel)]="modeloCliente.aMaterno">
                    </div>
                </div>
                <ng-template #elseBlock>
                    <div class="col-12">
                        <label class="form-label" for="">Nombre de empresa *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text" maxlength="254"
                                name="nombre" #nombre="ngModel" [(ngModel)]="modeloCliente.nombre" ngModel required>
                        <div [hidden]="nombre.valid || nombre.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                          </div>
                    </div>
                </ng-template>
                
                <div class="col-3">
                    <label class="form-label" for="">Correo *</label>
                    <input class="form-control" type="email" name="correo" #correo="ngModel" maxlength="80"
                            [(ngModel)]="modeloCliente.correo" ngModel pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" required>
                    <div [hidden]="correo.valid || correo.pristine" class="alert alert-danger">
                        CAMPO REQUERIDO EN FORMATO : correo@domino.com
                      </div>
                </div>
                <div class="col-3">
                    <label class="form-label" for="">Tipo cliente *</label>
                    <select class="form-select" name="idTipo" #idTipo="ngModel" [(ngModel)]="modeloCliente.idTipo" ngModel required>
                        <option selected disabled>Abrir para seleccionar</option>
                        <option *ngFor="let tp of tipocliente" value="{{tp.idTipo}}">{{tp.nombre}}</option>
                    </select>
                </div>
                <div class="col-2">
                    <label class="form-label" for="">¿Agregar direccion?</label>
                    <div class="col-md-3 offset-md-3">
                        <input class="form-check-input" type="checkbox" name="checkDireccion" [(ngModel)]="checkDireccion" id="flexCheckDefault2" (change)="openModalDirec(agregarDireccion)">
                    </div>
                    <!-- <button class="btn btn-success form-control" type="button" (click)="open(agregarDireccion)"> Agregar dirección</button> -->
                </div>
            </div>
            <hr>
            <div class="row align-items-start">
                <div class="col-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="isRFC" [(ngModel)]="isRFC" id="flexCheckDefault3">
                        <label class="form-check-label" for="flexCheckDefault3">¿Tiene RFC?</label>
                    </div>
                    <div *ngIf="isRFC == true; else RFCgenerico">
                        <input class="form-control" maxlength="13" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="rfc" #rfc="ngModel" [(ngModel)]="modeloCliente.rfc">
                        <div [hidden]="rfc.valid || rfc.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                          </div>
                    </div>
                    <ng-template #RFCgenerico>
                        <div>
                          <input class="form-control" value="XAXX010101000" readonly>
                        </div>
                      </ng-template>
                </div>
                <div class="col-3">
                        <label class="form-label" for="flexCheckDefault">¿Tiene credito?</label>
                        <br>
                        <input class="form-check-input" type="checkbox" value="false"  name="test" [(ngModel)]="isCredito" id="flexCheckDefault">
                </div>
    
                <div *ngIf="isCredito" class="col-3">
                    <label class="form-label" for="">Cantidad de credito</label>
                    <input class="form-control" type="number" name="credito" #credito="ngModel" pattern="^[0-9]{1,10}" [(ngModel)]="modeloCliente.credito">
                </div>
                
            </div>
            <hr>
            <div *ngIf="checkDireccion">
                <h5>Direccion</h5>
                <input type="text" class="form-control" value="{{cdireccion.estado}}. {{cdireccion.ciudad}}, {{cdireccion.colonia}} {{cdireccion.calle}} {{cdireccion.numExt}} {{cdireccion.numInt}} entre {{cdireccion.entreCalles}}" readonly>
            </div>
            <br>
            <div>
                <div class="col-12">
                    <button  class="btn btn-primary" type="submit" [disabled]="fGuardarCliente.invalid" (click)="guardarCliente()" (click)="modal.close()">Guardar</button>
                </div>
            </div>
        </form>
    </div>
    <!-- <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Guardar</button>
    </div> -->
</ng-template>

<!-- 2do modal de agregar cliente (direccion)-->
<ng-template #agregarDireccion let-modal>
    <form #FormCdir="ngForm">
        <div>
            <div class="modal-header">
                <h4 class="modal-title" id="modal-basic-title">Agregar direccion</h4>
                <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
              </div>
              <div class="modal-body">
                
                    <div  class="row align-items-start">
                      <div class="col-3">
                          <label class="form-label" for="">Pais *</label>
                          <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                    value="Mexico" name="pais" #pais="ngModel" [(ngModel)]="cdireccion.pais" maxlength="50" readonly>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Estado *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                value="Puebla" name="estado" #estado="ngModel" [(ngModel)]="cdireccion.estado" maxlength="50" readonly>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Ciudad *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="ciudad" #ciudad="ngModel" [(ngModel)]="cdireccion.ciudad" maxlength="50" required>
                        <div [hidden]="ciudad.valid || ciudad.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Colonia *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="colonia" #colonia="ngModel" [(ngModel)]="cdireccion.colonia" maxlength="50" required >
                        <div [hidden]="colonia.valid || colonia.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Calle *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="calle" #calle="ngModel" [(ngModel)]="cdireccion.calle" maxlength="50" required >
                        <div [hidden]="calle.valid || calle.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Numero exterior *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="numExt" #numExt="ngModel" [(ngModel)]="cdireccion.numExt" maxlength="10" required >
                        <div [hidden]="numExt.valid || numExt.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Numero interior</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="numInt" #numInt="ngModel" [(ngModel)]="cdireccion.numInt" maxlength="10" >
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Entre calles</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="entreCalles" #entreCalles="ngModel" [(ngModel)]="cdireccion.entreCalles" maxlength="50" >
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Codigo postal *</label>
                        <input class="form-control" type="number" pattern="^[0-9]{1,5}" min="0"
                                name="cp" #cp="ngModel" [(ngModel)]="cdireccion.cp" required>
                        <div [hidden]="cp.valid || cp.pristine" class="alert alert-danger">
                            SOLO INGRESAR DE 1 HASTA 5 NUMEROS
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Telefono *</label>
                        <input class="form-control" type="number" maxlength="10" min="1" pattern="^[0-9]{1,10}"
                                name="telefono" #telefono="ngModel" [(ngModel)]="cdireccion.telefono" required>
                        <div [hidden]="telefono.valid || telefono.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                            SOLO INGRESAR HASTA 10 NUMEROS
                        </div> 
                      </div>
                      <div class="col">
                        <label class="form-label" for="">Referencia *</label>
                        <textarea class="form-control" oninput="this.value = this.value.toUpperCase()" maxlength="254"
                                    cols="30" rows="2" name="referencia" #referencia="ngModel" [(ngModel)]="cdireccion.referencia" required ></textarea>
                        <div [hidden]="referencia.valid || referencia.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div> 
                      </div>
                    </div>
                
              </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success" [disabled]="FormCdir.invalid" (click)="modal.close('Save click')" >Guardar</button>
        </div>  
        </form>
</ng-template>

<!-- Modal para elegir direccion del cliente -->
<ng-template #buscarDireccion let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Seleccionar direccion</h4>
        <button class="btn btn-success col-auto offset-md-8" ngbTooltip="Agregar direccion" (click)="modalAgregarDireccion(nuevaDireccion)">
            <i class="bi bi-plus-circle-dotted" style="font-size: 1.3rem; color: rgb(255, 249, 249); left: 0;"></i>
        </button>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
      </div>
      <div class="modal-body">
        <table class="table table-dark table-hover">
            <thead>
                <tr>
                    <th scope="col">DIRECCION</th>
                    <th scope="col">REFERENCIA</th>
                    <th scope="col">TELEFONO</th>
                    <th scope="col">ZONA</th>
                </tr>
            </thead>
            <tbody *ngFor="let dc of listaDireccionesC">
                <tr (click)="seleccionarDireccion(dc.estado+' '+dc.ciudad+' '+dc.colonia+',CALLE '+dc.calle+' #'+dc.numExt+' INTERIOR '+dc.numInt+'    TELEFONO: '+dc.telefono+'   REFERENCIA: '+dc.referencia)" (click)="modal.dismiss('row click')">
                    <th scope="row">{{dc.estado}}, {{dc.ciudad}}, {{dc.colonia}}, CALLE {{dc.calle}}, #{{dc.numExt}} interior {{dc.numInt}}</th>
                    <th scope="row">{{dc.referencia}}</th>
                    <th scope="row">{{dc.telefono}}</th>
                    <th scope="row">{{dc.nombreZona}}</th>
                </tr>
            </tbody>
        </table>
      </div>
</ng-template>

<!-- Agregar nueva direccion  -->
<ng-template #nuevaDireccion let-modal>
    <form>
        <div>
            <div class="modal-header">
                <h4 class="modal-title" id="modal-basic-title">Agregar direccion</h4>
                <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
              </div>
              <div class="modal-body">
                
                    <div  class="row align-items-start">
                      <div class="col-3">
                          <label class="form-label" for="">Pais *</label>
                          <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                    value="Mexico" name="pais" #pais="ngModel" [(ngModel)]="nuevaDir.pais" maxlength="50" readonly>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Estado *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                value="Puebla" name="estado" #estado="ngModel" [(ngModel)]="nuevaDir.estado" maxlength="50" readonly>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Ciudad *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="ciudad" #ciudad="ngModel" [(ngModel)]="nuevaDir.ciudad" maxlength="50" required >
                        <div [hidden]="ciudad.valid || ciudad.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Colonia *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="colonia" #colonia="ngModel" [(ngModel)]="nuevaDir.colonia" maxlength="50" required >
                        <div [hidden]="colonia.valid || colonia.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Calle *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="calle" #calle="ngModel" [(ngModel)]="nuevaDir.calle" maxlength="50" required >
                        <div [hidden]="calle.valid || calle.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div>
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Numero exterior *</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="numExt" #numExt="ngModel" [(ngModel)]="nuevaDir.numExt" maxlength="10" required >
                        <div [hidden]="numExt.valid || numExt.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div> 
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Numero interior</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="numInt" #numInt="ngModel" [(ngModel)]="nuevaDir.numInt" maxlength="10" >
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Entre calles</label>
                        <input class="form-control" oninput="this.value = this.value.toUpperCase()" type="text"
                                name="entreCalles" #entreCalles="ngModel" [(ngModel)]="nuevaDir.entreCalles" maxlength="50" >
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Codigo postal *</label>
                        <input class="form-control" type="number" pattern="^[0-9]{1,5}" min="0"
                                name="cp" #cp="ngModel" [(ngModel)]="nuevaDir.cp" required >
                        <div [hidden]="cp.valid || cp.pristine" class="alert alert-danger">
                            SOLO INGRESAR DE 1 HASTA 5 NUMEROS
                        </div> 
                      </div>
                      <div class="col-3">
                        <label class="form-label" for="">Telefono *</label>
                        <input class="form-control" type="number" maxlength="10" min="0" pattern="^[0-9]{1,10}"
                                name="telefono" #telefono="ngModel" [(ngModel)]="nuevaDir.telefono" required >
                        <div [hidden]="telefono.valid || telefono.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                            SOLO INGRESAR HASTA 10 NUMEROS
                        </div>
                      </div>
                      <div class="col">
                        <label class="form-label" for="">Referencia *</label>
                        <textarea class="form-control" oninput="this.value = this.value.toUpperCase()" maxlength="254"
                                    cols="30" rows="2" name="referencia" #referencia="ngModel" [(ngModel)]="nuevaDir.referencia" required ></textarea>
                        <div [hidden]="referencia.valid || referencia.pristine" class="alert alert-danger">
                            CAMPO REQUERIDO
                        </div> 
                      </div>
                    </div>
                
              </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success" (click)="guardarNuevaDireccion()" (click)="modal.close()"  >Guardar</button>
            </div>  
        </form>
</ng-template>

<!-- Modal productos -->
 <ng-template #mBuscarProducto let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Buscar producto</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
      <div class="modal-body">
        
        <div >
            <div class="input-group mb-2">
                <div class="col-2">
                    <select class="form-select" name="seleccionado" [(ngModel)]="seleccionado" (ngModelChange)="selectBusqueda()">
                        <option value="uno">DESCRIPCION</option>
                        <option value="dos">CLAVE EXTERNA</option>
                        <option value="tres">CODIGO DE BARRAS</option>
                    </select>
                </div>
                 <div class="col">
                    <input type="search" class="form-control" name="buscar" placeholder=" Buscar ..." [(ngModel)]="buscar" (ngModelChange)="selectBusqueda()">
                </div>
            </div>
                <br>
                <div class="text-center text-primary" *ngIf="isLoadingProductos">
                    <br>
                    <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="4"></p-progressSpinner>
                    <!-- <div class="spinner-border" role="status" >
                        <span class="visually-hidden">Loading...</span>
                    </div> -->
                </div>
              <table *ngIf="!isLoadingProductos" class="table table-sm table-dark table-hover">
                <thead>
                    <tr>
                        <th>CLAVE EXTERNA</th>
                        <th>CODIGO DE BARRAS</th>
                        <th>DESCRIPCION</th>
                        <th>MARCA</th>
                        <th>DEPARTAMENTO</th>
                        <!-- <th>CATEGORIA</th> -->
                    </tr>
                </thead>
                <tbody *ngFor="let pr of productos | paginate:{id:'pcModal',itemsPerPage: itemsPerPage, currentPage: pageActual2, totalItems:totalPages}">
                    <tr (click)="modalMuestraMedidas(mProdMedidas,pr.idProducto,pr.claveEx)">
                        <th scope="row">{{pr.claveEx}}</th>
                        <th scope="row">{{pr.cbarras}}</th>
                        <th scope="row">{{pr.descripcion}}</th>
                        <th scope="row">{{pr.nombreMarca}}</th>
                        <th scope="row">{{pr.nombreDep}}</th>
                        <!-- <th scope="row">{{pr.nombreCat}}</th> -->
                    </tr>
                </tbody>
              </table>
              <pagination-controls  id="pcModal"
                                    (pageChange)="getPage(pageActual2 = $event)"
                                    previousLabel="Anterior"
                                    nextLabel="Siguiente" >
              </pagination-controls>
        </div>
    </div>
</ng-template>

<!-- Modal medidas | precio de productos -->
<ng-template #mProdMedidas let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Medidas del producto: {{claveExt}}</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <div class=" row justify-content-center">
            <div class="col-2">
                <img src="{{url + 'productos/getImageProduc/' + this.imagenPM}}" width="100px">
            </div>
            <div class="col-5 text-center">
                <table class="table table-secondary table-sm">
                    <thead  >
                        <!-- <tr>
                            <th colspan="6"><h6 class="fw-bold">{{claveExt}}</h6></th>
                        </tr> -->
                        <tr>
                            <th scope="col">PREC.</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.nombreMedida}}</th>
                        </tr>
                    </thead>
                    <tbody >
                        <tr>
                            <th scope="row">P1</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.precio1 | currency}}</th>
                        </tr>
                        <tr>
                            <th scope="row">P2</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.precio2 | currency}}</th>
                        </tr>
                        <tr>
                            <th scope="row">P3</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.precio3 | currency}}</th>
                        </tr>
                        <tr>
                            <th scope="row">P4</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.precio4 | currency}}</th>
                        </tr>
                        <tr>
                            <th scope="row">P5</th>
                            <th *ngFor="let pm of prod_med" scope="row">{{pm.precio5 | currency}}</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- TABLA EXISTENCIA -->
            <div class="col-auto text-center">
                <table class="table table-sm table-secondary">
                    <thead>
                        <tr>
                            <th>EXISTENCIA</th>
                            <th>MEDIDA</th>
                        </tr>
                    </thead>
                    <tbody *ngFor="let e of existenciasPorMed">
                        <tr>
                            <th scope="col">{{e.exisCal}}</th>
                            <th scope="col">{{e.nombreMedida}}</th>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <div class="col">

            <button class="btn btn-danger form-control" (click)="modal.dismiss('Cross click')">Cancelar</button>
        </div>
        <div class="col">
            <button class="btn btn-success form-control" (click)="seleccionarProducto(idp)">Agregar</button>
        </div>
    </div> 
</ng-template>

<!-- Modal alerta de existencia -->
<ng-template #mAlertaExistencia let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Alerta</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <p class="text-center">Algunos productos no cuenta con stock suficiente o estan agotados. ¿Seguro que desea continuar?</p>
    </div>
    <div class="modal-footer">
        <div class="col">

            <button class="btn btn-danger form-control" (click)="modal.dismiss('Cross click')">Cancelar</button>
        </div>
        <div class="col">
            <button class="btn btn-success form-control" (click)="creaCotizacion()"(click)="modal.dismiss('Cross click')">Si</button>
        </div>
    </div>
</ng-template>



